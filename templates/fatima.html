<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Recorder</title>
</head>
<body>
<h1>Audio Recorder</h1>
<button id="recordButton">Record</button>
<button id="stopButton" disabled>Stop</button>
<p id="statusMessage"></p>
<audio id="audioPlayback" controls style="display: none;"></audio>
<script>
// Initialize variables
let recorder;
let audioChunks = [];

// Access the microphone and start recording
async function startRecording() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recorder = new MediaRecorder(stream);

        recorder.addEventListener('dataavailable', (event) => {
            audioChunks.push(event.data);
        });

        recorder.addEventListener('stop', () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioPlayback = document.getElementById('audioPlayback');
            audioPlayback.src = audioUrl;
            audioPlayback.style.display = 'block';

            // Send audio data to server for further processing
            sendAudioToServer(audioBlob);

            audioChunks = [];
        });

        recorder.start();
        document.getElementById('recordButton').disabled = true;
        document.getElementById('stopButton').disabled = false;
        document.getElementById('statusMessage').textContent = 'Recording...';
    } catch (err) {
        console.error('Error accessing microphone:', err);
        document.getElementById('statusMessage').textContent = 'Error: ' + err.message;
    }
}

// Stop recording
function stopRecording() {
    recorder.stop();
    document.getElementById('recordButton').disabled = false;
    document.getElementById('stopButton').disabled = true;
    document.getElementById('statusMessage').textContent = '';
}

// Event listeners for record and stop buttons
document.getElementById('recordButton').addEventListener('click', startRecording);
document.getElementById('stopButton').addEventListener('click', stopRecording);

// Function to send recorded audio to the server
async function sendAudioToServer(audioBlob) {
    const formData = new FormData();
    formData.append('audio', audioBlob);

    try {
        const response = await fetch('/process_audio', {
            method: 'POST',
            body: formData
        });
        if (response.ok) {
            console.log('Audio sent to server successfully.');
        } else {
            throw new Error('Failed to send audio to server.');
        }
    } catch (err) {
        console.error('Error sending audio to server:', err);
    }
}
</script>
</body>
</html>
